<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Movie Voting</title>
<style>
.main-container {
	width: 80%;
	margin: 0 auto;
	padding: 20px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	border-radius: 10px;
}

.content-container {
	display: flex;
	justify-content: space-between;
}

.movies-container, .vote-container {
	flex: 1;
	padding: 20px;
	border: 1px solid #ddd;
	border-radius: 5px;
}

.movie-info {
	display: flex;
	margin-bottom: 20px;
	padding: 10px;
	border: 1px solid #eee;
	border-radius: 5px;
}

.movie-details {
	margin-left: 20px;
}

img {
	width: 150px;
	height: auto;
}

#vote-form {
	display: flex;
	flex-direction: column;
}

.vote-option {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 10px;
}

.vote-option input[type="radio"] {
	margin-right: 10px;
}

button {
	padding: 10px;
	background-color: #4CAF50;
	color: white;
	border: none;
	border-radius: 5px;
	cursor: pointer;
}

#view-results {
	margin-top: 20px;
	background-color: #008CBA;
	width: 100%;
}

.vote-button {
	display: flex;
	justify-content: flex-end;
	margin-top: 10px;
}

.chart-container {
	width: 100%;
	max-width: 400px;
	margin: auto;
}

#vote-chart {
	width: 100%;
	height: 300px;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>





</head>
<body>

<script>
    // JSP에서 전달된 투표 수 데이터를 JavaScript 변수로 설정
    var movieTitles = ["${movie1.title}", "${movie2.title}"];
    var voteCounts = [${movie1Votes}, ${movie2Votes}];

    console.log("Movie Titles: ", movieTitles);  // movieTitles 값 출력
    console.log("Vote Counts: ", voteCounts);    // voteCounts 값 출력
    
    
    
    // 차트 초기화 (페이지 로드 시 한 번만 실행)
    const ctx = document.getElementById('vote-chart');
    const voteChart = new Chart(ctx, {
        type: 'bar',  // 차트 타입 설정
        data: {
            labels: movieTitles,  // 영화 제목을 레이블로 사용
            datasets: [{
                label: '투표수',  // 데이터셋 레이블
                data: voteCounts,  // 각 영화의 투표 수
                backgroundColor: [
                    'rgba(75, 192, 192, 0.6)',  // 첫 번째 영화 색상
                    'rgba(153, 102, 255, 0.6)'  // 두 번째 영화 색상
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',  // 첫 번째 영화 테두리 색상
                    'rgba(153, 102, 255, 1)'  // 두 번째 영화 테두리 색상
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero:true }  // Y축이 0부터 시작하도록 설정
            },
            responsive:true  // 화면 크기에 맞게 차트 크기 자동 조정
        }
    });

    // "결과 먼저 보기" 버튼 클릭 시 실행되는 이벤트
    document.getElementById("view-results").addEventListener("click", function(){
        // 투표 폼 숨기고 결과 컨테이너 보이기
        document.getElementById("vote-form-container").style.display = "none";
        document.getElementById("results-container").style.display = "block";
    });

    // "다시 투표하기" 버튼 클릭 시 실행되는 이벤트
    document.getElementById("back-to-vote").addEventListener("click", function() {
        // 결과 컨테이너 숨기고 투표 폼 보이기
        document.getElementById("results-container").style.display = "none";
        document.getElementById("vote-form-container").style.display = "block";
    });
</script>



	<jsp:include page="../../layout/title.jsp" />

	<div class="main-container">
		<div class="content-container">
			<div class="movies-container">
				<div class="movie-info">
					<img src="/images/${movie1.title}.jpg" alt="${movie1.title}">
					<div class="movie-details">
						<h2>${movie1.title}</h2>
						<p>${fn:substring(movie1.description,0,100)}...</p>
					</div>
				</div>

				<div class="movie-info">
					<img src="/images/${movie2.title}.jpg" alt="${movie2.title}">
					<div class="movie-details">
						<h2>${movie2.title}</h2>
						<p>${fn:substring(movie2.description,0,100)}...</p>
					</div>
				</div>
			</div>

			<div class="vote-container">
				<div id="vote-form-container">
					<form id="vote-form">
						<div class="vote-option">
							<label><input type="radio" name="movie"
								value="${movie1.movie_id}"> <span>"${movie1.title}"</span></label>
						</div>

						<div class="vote-option">
							<label><input type="radio" name="movie"
								value="${movie2.movie_id}"> <span>${movie2.title}</span></label>
						</div>

						<div class="vote-button">
							<button id="vote-button" type="submit">투표</button>
						</div>
					</form>

					<button id="view-results">결과 먼저 보기</button>
				</div>

				<div id="results-container" style="display: none;">
					<div class="chart-container">
						<canvas id="vote-chart"></canvas>
					</div>
					<button id="back-to-vote">다시 투표하기</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>